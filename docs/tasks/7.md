## Overview

Refactor `src/index.js` from a functional approach to a class-based architecture to support:
- Multiple tree instances
- Dynamic tree/metadata loading and switching
- Better state encapsulation and management
- Easier testing and maintenance

## Proposed Architecture

### Class Structure

HeatTree (main class)
├── TreeData (data management)
│   ├── root (D3 hierarchy)
│   ├── displayedRoot (current view)
│   ├── metadataMap
│   ├── columnTypes
│   └── colorScales
├── TreeState (UI state)
│   ├── selectedNode
│   ├── currentTransform
│   ├── manualZoomAndPanEnabled
│   ├── isCircularLayout
│   ├── currentLabelTextColumn
│   ├── currentColorColumn
│   └── scaling factors
├── TreeRenderer (rendering logic)
│   ├── DOM references
│   ├── update() method
│   └── rendering helpers
└── TreeControls (UI controls)
├── buttons
├── dropdowns
└── legends


### Implementation Plan


#### Phase 1: Create Core Classes

1. **Create `TreeData` class** (`src/treeData.js`)
 - Constructor accepts newick string and metadata
 - Methods:
   - `parseTree(newickStr)` - parse newick and create hierarchy
   - `parseMetadata(metadataStr)` - parse metadata
   - `addMetadata(metadataStr, id = null)` - parse metadata and store it. return metadata ID 
   - `enableMetadata(metadataId)` - specify that this metadata table should be attached to the tree data
   - `disableMetadata(metadataId)` - specify that this metadata table should not be attached to the tree data
   - `attachMetadata()` - link all enabled metadata to parsed tree nodes. remove data no longer enabled

2. **Create `TreeState` class** (`src/treeState.js`)
 - associated with a `TreeData` instance 
 - Constructor accepts initial options
 - Properties for things that affect tree appearance
 - Methods:
   - `setTransform(transform)` - update zoom/pan
   - `setSelectedNode(node)` - update selection
   - `toggleLayout()` - toggle circular/rectangular
   - `setLabelColumn(column)` - change label text
   - `setColorColumn(column)` - change label coloring
   - `toggleZoom()` - toggle zoom enabled
   - `updateScaling(factors)` - update scaling factors
   - `getNodeLabelText(node, column)` - get label for node
   - `getNodeColor(node, column)` - get color for node
   - `collapseSubtree(node)` - collapse a subtree
   - `expandSubtree(node)` - expand a subtree
   - `collapseRoot(node)` - restrict the tree to the node
   - `expandRoot()` - expand the last collapsed root
   - `setDisplayedRoot(node)` - change root
   - `getState()` - serialize current state
   - `setState(state)` - restore state

3. **Create `TreeRenderer` class** (`src/treeRenderer.js`)
 - Constructor accepts container, treeData, treeState, options
 - Methods:
   - `initialize()` - create DOM structure
   - `update(expanding, fit, initial)` - main update method
   - `render()` - render current state
   - `fitToView(transition)` - fit tree to viewport
   - `renderSelection()` - render the selection shape and associated controls
   - `updateLegends(...)` - update all legends
   - `destroy()` - cleanup
 - Private helper methods for:
   - Layout calculations
   - Branch rendering
   - Node rendering
   - Label positioning
   - Bounds calculation

4. **Create `TreeControls` class** (`src/treeControls.js`)
 - Constructor accepts container, callbacks, options
 - Methods:
   - `initialize()` - create all controls
   - `updateExpandRootButton(enabled)` - update button state
   - `updateZoomButton(enabled)` - update button state
   - `updateCircularButton(enabled)` - update button state
   - `destroy()` - cleanup

5. **Create `HeatTree` class** (`src/heatTree.js`)
   - Constructor accepts container selector and options
   - Properties:
     - `treeData` - TreeData instance
     - `treeState` - TreeState instance
     - `renderer` - TreeRenderer instance
     - `controls` - TreeControls instance
   - Public methods:
     - `loadTree(newickStr, metadata)` - load new tree data
     - `switchTree(treeData)` - switch to different tree
     - `getState()` - get current state
     - `setState(state)` - restore state
     - `exportSvg()` - export current view
     - `destroy()` - cleanup and remove
   - Private methods:
     - `_initialize()` - setup components
     - `_wireCallbacks()` - connect components

6. **Update `src/index.js`**
   - Export `HeatTree` class as default
   - Keep `heatTree()` function as wrapper for backwards compatibility
   - Function creates and returns HeatTree instance

